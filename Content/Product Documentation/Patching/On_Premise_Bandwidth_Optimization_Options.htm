<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../../Resources/TableStyles/ax_tables.css" rel="stylesheet" MadCap:stylesheetType="table" /><title></title>
    </head>
    <body>
        <h1>On-Premise Bandwidth Optimization Options</h1>
        <h2>Summary</h2>
        <p>Automox is the easiest-to-use, most-recommended, most efficient cloud-native solution for endpoint hardening--anywhere, in an instant. Being a cloud-native platform, Automox makes it possible to manage Windows, macOS, and Linux devices with one solution without purchasing physical hardware or installing a management application. As companies move to internet-based modern solutions, some of the challenges of legacy solutions are immediately solved, while others remain. The purpose of this document is to present the most common challenges, and provide guidance on how to utilize native technologies while working to preserve the intent of a cloud first, infrastructure-less solution.</p>
        <h2>Solutions</h2>
        <h3>Quality of Service (QoS)</h3>
        <p>Palo Alto Networks explains Quality of Service (QoS) as the following:</p>
        <blockquote>
            <p>“Quality of Service (QoS) is a set of technologies that work on a network to guarantee its ability to dependably run high-priority applications and traffic under limited network capacity. QoS technologies accomplish this by providing differentiated handling and capacity allocation to specific flows in network traffic. This enables the network administrator to assign the order in which packets are handled, and the amount of bandwidth afforded to that application or traffic flow…”</p>
            <p>“The QoS mechanisms for ordering packets and allotting bandwidth are queuing and bandwidth management respectively. Before they can be implemented however, traffic must be differentiated using classification tools. The classification of traffic according to policy allows organizations to ensure the consistency and adequate availability of resources for their most important applications.</p>
            <p>Traffic can be classified crudely by port or IP, or using a more sophisticated approach such as by application or user. The latter parameters allow for more meaningful identification, and consequently, classification of the data.</p>
            <p>Next, queuing and bandwidth management tools are assigned rules to handle traffic flows specific to the classification they received upon entering the network.</p>
            <p>The queuing mechanism allows for packets within traffic flows to be stored until the network is ready to process it. Priority Queuing (PQ) is developed to ensure the necessary availability and minimal latency of network performance for the most important batches of applications and traffic by providing an assigned priority and specific bandwidth to them based on their classification. This ensures the most important activities on a network are not starved of bandwidth by activities of lower priority. Applications, users, and traffic can be batched in up to 8 differentiated queues.</p>
            <p>Bandwidth management mechanisms measure and control traffic flows on the network to avoid exceeding its capacity and the resulting network congestion that occurs. Mechanisms for bandwidth management include traffic shaping, a rate limiting technique used to optimize or guarantee performance and increase usable bandwidth where necessary, and scheduling algorithms, which offer varied methods for providing bandwidth to specific traffic flows.” (See <MadCap:xref href="#Referenc">References</MadCap:xref>.)</p>
        </blockquote>
        <h3>Windows Delivery Optimization (DO)</h3>
        <p>Microsoft explains Delivery Optimization (DO) as the following:</p>
        <blockquote>
            <p>“<a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization" rel="nofollow">Delivery Optimization</a> is a new peer-to-peer distribution method in Windows 10. Windows 10 clients can source content from other devices on their local network that have already downloaded the updates or from peers over the internet. Using the settings available for Delivery Optimization, clients can be configured into groups, allowing organizations to identify devices that are possibly the best candidates to fulfill peer-to-peer requests.</p>
            <p>“Windows updates, upgrades, and applications can contain packages with very large files. Downloading and distributing updates can consume quite a bit of network resources on the devices receiving them. You can use Delivery Optimization to reduce bandwidth consumption by sharing the work of downloading these packages among multiple devices in your deployment. Delivery Optimization can accomplish this because it is a self-organizing distributed cache that allows clients to download those packages from alternate sources (such as other peers on the network) in addition to the traditional Internet-based servers. Delivery Optimization is a cloud-managed solution. Access to the Delivery Optimization cloud services is a requirement. This means that in order to use the peer-to-peer functionality of Delivery Optimization, devices must have access to the internet.” (See <MadCap:xref href="#Referenc">References</MadCap:xref>.)</p>
        </blockquote>
        <h4>DO Requirements and Supported Download Package Types</h4>
        <h5>Requirements</h5>
        <p>The following table lists the minimum Windows 10 version that supports Delivery Optimization (See <MadCap:xref href="#Referenc">References</MadCap:xref>.):</p>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <col class="TableStyle-ax_tables-Column-Column1" />
            <col class="TableStyle-ax_tables-Column-Column1" />
            <thead>
                <tr class="TableStyle-ax_tables-Head-Header1">
                    <th class="TableStyle-ax_tables-HeadE-Column1-Header1">
                        <p><strong>Device type</strong>
                        </p>
                    </th>
                    <th class="TableStyle-ax_tables-HeadD-Column1-Header1">
                        <p><strong>Minimum Windows version</strong>
                        </p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p>Computers running Windows 10</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p>1511</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>Computers running server core installations of Windows Server</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>1709</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyB-Column1-Body1">
                        <p>IoT devices</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>1803</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Types of download packages supported by delivery optimization</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 380.0px;" />
                <col style="width: 380.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <th class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p><strong>Download package</strong>
                        </p>
                    </th>
                    <th class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p><strong>Minimum Windows version</strong>
                        </p>
                    </th>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>Windows 10 updates (feature updates and quality updates)</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>1511</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p>Windows 10 drivers</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p>1511</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>Windows Store files</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>1511</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p>Windows Store for Business files</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p>1511</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>Windows Defender definition updates</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>1511</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p>Microsoft 365 Apps and updates</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p>1709 (for more information, see <a href="https://docs.microsoft.com/en-us/deployoffice/delivery-optimization" rel="nofollow">Delivery Optimization and Microsoft 365 Apps</a>)</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>Win32 apps for Intune</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>1709</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p>XBox Game Pass games</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p>2004</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>MSIX apps (HTTP downloads only)</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>2004</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body1">
                        <p>Configuration Manager Express updates</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body1">
                        <p>1709 + Configuration Manager version 1711</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body2">
                    <td class="TableStyle-ax_tables-BodyE-Column1-Body2">
                        <p>Edge browser installs and updates</p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyD-Column1-Body2">
                        <p>1809</p>
                    </td>
                </tr>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyB-Column1-Body1">
                        <p><a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/the-benefits-of-windows-10-dynamic-update/ba-p/467847" rel="nofollow">Dynamic updates</a>
                        </p>
                    </td>
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>1903</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>How Microsoft uses Delivery Optimization</h5>
        <blockquote>
            <p>“At Microsoft, to help ensure that ongoing deployments weren't affecting our network and taking away bandwidth for other services, Microsoft IT used a couple of different bandwidth management strategies. Delivery Optimization, peer-to-peer caching enabled through Group Policy, was piloted and then deployed to all managed devices using Group Policy. Based on recommendations from the Delivery Optimization team, we used the "group" configuration to limit sharing of content to only the devices that are members of the same Active Directory domain… More than 76 percent of content came from peer devices versus the Internet.” (See <MadCap:xref href="#Referenc">References</MadCap:xref>.)</p>
        </blockquote>
        <h4>DO: Frequently Asked Questions</h4>
        <h5>Does Delivery Optimization work with WSUS? </h5>
        <p>Yes. Devices will obtain the update payloads from the WSUS server, but must also have an internet connection as they communicate with the Delivery Optimization cloud service for coordination.</p>
        <h5>Which ports does Delivery Optimization use? </h5>
        <p>Delivery Optimization listens on port 7680 for requests from other peers by using TCP/IP. The service will register and open this port on the device, but you might need to set this port to accept inbound traffic through your firewall yourself. If you don't allow inbound traffic over port 7680, you can't use the peer-to-peer functionality of Delivery Optimization. However, devices can still successfully download by using HTTP or HTTPS traffic over port 80 (such as for default Windows Update data).</p>
        <p>If you set up Delivery Optimization to create peer groups that include devices across NATs (or any form of internal subnet that uses gateways or firewalls between subnets), it will use Teredo. For this to work, you must allow inbound TCP/IP traffic over port 3544. Look for a "NAT traversal" setting in your firewall to set this up.</p>
        <p>Delivery Optimization also communicates with its cloud service by using HTTP/HTTPS over port 80.</p>
        <h5>What are the requirements if I use a proxy?</h5>
        <p>For Delivery Optimization to successfully use the proxy, you should set up the proxy by using Windows proxy settings or Internet Explorer proxy settings. For details see <a href="https://docs.microsoft.com/en-us/windows/deployment/update/delivery-optimization-proxy" rel="nofollow">Using a proxy with Delivery Optimization</a>. Most content downloaded with Delivery Optimization uses byte range requests. Make sure your proxy allows byte range requests. For more information, see <a href="https://support.microsoft.com/help/3175743/proxy-requirements-for-windows-update" rel="nofollow">Proxy requirements for Windows Update</a>.</p>
        <h5>What hostnames should I allow through my firewall to support Delivery Optimization?</h5>
        <p>For communication between clients and the Delivery Optimization cloud service: *.do.dsp.mp.microsoft.com.</p>
        <p>For Delivery Optimization metadata:</p>
        <ul>
            <li>*.dl.delivery.mp.microsoft.com</li>
            <li>*.emdl.ws.microsoft.com</li>
        </ul>
        <p>For the payloads (optional):</p>
        <ul>
            <li>*.download.windowsupdate.com</li>
            <li>*.windowsupdate.com</li>
        </ul>
        <h5>Does Delivery Optimization use multicast?</h5>
        <p>No. It relies on the cloud service for peer discovery, resulting in a list of peers and their IP addresses. Client devices then connect to their peers to obtain download files over TCP/IP.</p>
        <h5>How does Delivery Optimization deal with congestion on the router from peer-to-peer activity on the LAN?</h5>
        <p>Starting in Windows 10, version 1903, Delivery Optimization uses LEDBAT to relieve such congestion. For more details see this post on the <a href="https://techcommunity.microsoft.com/t5/Networking-Blog/Windows-Transport-converges-on-two-Congestion-Providers-Cubic/ba-p/339819" rel="nofollow">Networking Blog</a>.</p>
        <h5>How does Delivery Optimization handle VPNs?</h5>
        <p>Delivery Optimization attempts to identify VPNs by checking the network adapter type and details and will treat the connection as a VPN if the adapter description contains certain keywords, such as "VPN" or "secure."</p>
        <p>If the connection is identified as a VPN, Delivery Optimization will suspend uploads to other peers. However, you can allow uploads over a VPN by using the <a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-reference#enable-peer-caching-while-the-device-connects-via-vpn" rel="nofollow">Enable Peer Caching while the device connects via VPN policy</a>.</p>
        <p>If you have defined a boundary group in Configuration Manager for VPN IP ranges, you can set the DownloadMode policy to 0 for that boundary group to ensure that there will be no peer-to-peer activity over the VPN. When the device is not connected via VPN, it can still leverage peer-to-peer with the default of LAN.</p>
        <p>With split tunneling, make sure to allow direct access to these endpoints:</p>
        <p>Delivery Optimization service endpoint:</p>
        <ul>
            <li>https://*.prod.do.dsp.mp.microsoft.com</li>
        </ul>
        <p>Delivery Optimization metadata:</p>
        <ul>
            <li>http://emdl.ws.microsoft.com</li>
            <li>http://*.dl.delivery.mp.microsoft.com</li>
        </ul>
        <p>Windows Update and Microsoft Store backend services and Windows Update and Microsoft Store payloads</p>
        <ul>
            <li>http://*.windowsupdate.com&gt;</li>
            <li>https://*.delivery.mp.microsoft.com</li>
            <li>https://*.update.microsoft.com</li>
            <li>https://tsfe.trafficshaping.dsp.mp.microsoft.com " [6]</li>
        </ul>
        <h3>Troubleshooting</h3>
        <p>Common problems and solutions can be found here: <a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization#troubleshooting" rel="nofollow">Troubleshooting</a></p>
        <h3>Caching</h3>
        <h4>Content Caching (macOS)</h4>
        <p>Content Caching allows a Mac administrator to set up a single or multiple macOS devices to download software updates to this device and then distribute them to all other macOS devices without downloading the software updates again for each device from the internet. Content caching will also give you the flexibility to choose what content gets cached as well.</p>
        <h5>How do I set up Content Caching?</h5>
        <p>Setting up content caching on the host and peer devices is easy to follow in the Apple <a href="https://support.apple.com/guide/mac-help/set-content-cache-clients-peers-parents-mac-mchl9b56e1cf/11.0/mac/11.0" rel="nofollow">guide</a> on how to do this.&#160;</p>
        <h5>Why would I want to set up Content Caching?&#160;</h5>
        <p>Content Caching can be helpful in environments where internet bandwidth is limited. Deploying a Patch Policy via Automox to all devices in a centralized location can cause saturation to your local network, and can slow it down for your end-users.</p>
        <h5>When do I want to set up Content Caching?&#160;</h5>
        <p>You should want to set up Content Caching if you have multiple macOS devices into a centralized location, in most cases this will be a corporate office. Setting up one or more hosts will allow any macOS devices in the same subnet (or in some cases, the same Public IP address) to pull cached content from those host devices. You can also set up Content Caching for macOS devices that are on the go, that way if they can’t see the host device it will update the operating system from the internet instead. Content Caching does not need to be set up for organizations that have a fully remote staff. Content Caching is also not recommended to be used over a VPN.&#160;</p>
        <h5>Requirements to setup Content Caching:</h5>
        <ul>
            <li>A Mac device running macOS 10.13.5 or higher<ul><li>Apple recommends any device running OS X 10.8.2; however, at the time this article is written, Automox only supports macOS 10.13+.</li><li>You can also set up multiple macOS host devices to distribute content to specific devices, if necessary.</li></ul></li>
            <li>The macOS device connected to the internet.<ul><li>It is recommended to hardwire a device with ethernet if possible.</li><li>It is also recommended to disable any other connections on the device.</li><li>A 1 GB ethernet connection or greater is recommended.</li></ul></li>
            <li>Line-of-sight to devices that will download software updates from the host device.<ul><li>This can also be accomplished with multiple subnets, as long as those devices have the same Public IP address.</li></ul></li>
            <li>Other Best Practices provided by Apple:<ul><li>Allow all Apple push notifications.</li><li>Don’t use manual proxy settings.</li><li>Don’t proxy client requests to content caches.</li><li>Bypass proxy authentication for content caches.</li><li>Specify a TCP port for caching. (See Port key in <a href="https://support.apple.com/guide/mac-help/configure-advanced-content-caching-settings-mchl91e7141a/11.0/mac/11.0" rel="nofollow">Configure advanced content caching settings on Mac</a>.)</li><li>Manage inter-site caching traffic.</li><li>Block rogue cache registration.</li><li>Use a static public IP address for content caches</li></ul></li>
        </ul>
        <h5>Bandwidth Limiting</h5>
        <p>Ensure that your local network can handle passing data to multiple devices before setting up content caching. While your local network bandwidth may be high, it is good to remember that each macOS software update is usually around 3 GBs or more, and multiple devices receiving this update simultaneously will saturate your local network. It is also good to note that Content Caching is not useful if you are supporting a largely remote environment, as bandwidth may not be as much of a concern.</p>
        <p>If you want to deploy cached content to local machines, you may use <a href="https://support.apple.com/guide/mac-help/configure-advanced-content-caching-settings-mchl91e7141a/11.0/mac/11.0" rel="nofollow">this guide</a> from Apple to modify the existing com.apple.AssetCache plist to help with limiting bandwidth on your local network. The defaults write command can accomplish this, or an MDM that can deploy configuration profiles.</p>
        <p>It is recommended to add these plist strings to com.apple.AssetCache to help with bandwidth limiting:</p>
        <p>
            <img src="../../Resources/Images/onprem-plist-strings.png" />
        </p>
        <p>Plist strings to add to the "com.apple.AssetCache" plist</p>
        <h5>Considerations</h5>
        <p>Cached content is stored in the boot drive of the host machine. If your boot drive free space gets too full, old cached content that is rarely used will be deleted in place of newer versions. The AllowCacheDelete plist string is enabled by default to clear old cached content.</p>
        <p>After you set up Content Caching, peer devices may take some time to discover the host device. While Apple does not publish how long this takes, restarting the peer machine may help discover the host device quicker.</p>
        <h5>Helpful Links</h5>
        <ul>
            <li><a href="https://support.apple.com/guide/mac-help/what-is-content-caching-on-mac-mchl9388ba1b/mac" rel="nofollow">What is content caching on Mac?</a>
            </li>
            <li><a href="https://support.apple.com/guide/mac-help/set-content-cache-clients-peers-parents-mac-mchl9b56e1cf/11.0/mac/11.0" rel="nofollow">Set up content cache clients, peers, or parents on Mac</a>
            </li>
            <li><a href="https://support.apple.com/guide/mac-help/use-multiple-content-caches-on-mac-mchle150fb54/11.0/mac/11.0" rel="nofollow">Use multiple content caches on Mac</a>
            </li>
            <li><a href="https://support.apple.com/en-us/HT204675" rel="nofollow">Content types supported by content caching in macOS</a>
            </li>
            <li><a href="https://support.apple.com/guide/mac-help/configure-advanced-content-caching-settings-mchl91e7141a/11.0/mac/11.0" rel="nofollow">Configure advanced content caching settings on Mac (Plist Modification)</a>
            </li>
        </ul>
        <h2>Considerations</h2>
        <p><a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-setup" rel="nofollow">Set up Delivery Optimization for Windows 10 updates</a>
        </p>
        <p><a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-reference" rel="nofollow">Delivery Optimization reference</a>
        </p>
        <p><a href="https://docs.microsoft.com/en-us/archive/blogs/mniehaus/windows-10-delivery-optimization-and-wsus-take-2" rel="nofollow">Blog - Michael Niehaus (details unreferenced elsewhere)</a>
        </p>
        <h2 id="On-PremiseBandwidthOptimizationOptions-BestPractices">Best Practices</h2>
        <h3>Delivery Optimization</h3>
        <p>We have a few examples of how Delivery Optimization settings can be configured to increase peer sharing and throttle network bandwidth. &#160;These are provided as a fully functional example, but consider what settings are most appropriate for your environment.</p>
        <h4>Suggested for 1803 and later</h4>
        <ul>
            <li>Download Mode: LAN (1)</li>
            <li>Group ID : (GUID per location. &#160;Only needed with specific Download modes)***</li>
            <li>Select the source of Group IDs : (The options set in this policy only apply to Group (2) download mode. If Group (2) isn't set as Download mode, this policy will be ignored.)***</li>
            <li>Absolute Max Cache Size: 30 GB</li>
            <li>Allow uploads while the device is on battery while under set Battery level: 40</li>
            <li>Delay background download from http (in secs): 600 (10 min)**</li>
            <li>Delay Foreground download from http (in secs): 600 (10 min)**</li>
            <li>Max Cache Age: 2592000 (30 days)Maximum Download Bandwidth (in KB/s): 500 (500 KB/s = 4 mbit)*</li>
            <li>Minimum Peer Caching Content File Size (in MB): 1</li>
            <li>Minimum RAM (inclusive) allowed to use Peer Caching (in GB): 2</li>
        </ul>
        <p>*The Maximum Download Bandwidth setting was removed in version 2004, and replaced with new settings for throttling traffic based on Foreground or Background channels.</p>
        <p>**NOTE: As of March 31 2021, Automox leverages the Foreground channel to download updates. There is work to change the channel used for downloading updates to the background channel. Suggestion is to delay the background channel traffic only and not delay the foreground channel once Automox switches its channel use.</p>
        <p>***Specific to Download Mode and Group settings. Only needed in association with specific selections.</p>
        <h4><strong>Suggested for 2004 and later</strong>
        </h4>
        <ul>
            <li>Settings defined for 1803 and later</li>
            <li>Maximum Foreground Download Bandwidth (in KB/s): 500*</li>
            <li>Maximum Background Download Bandwidth (in KB/s): 500*</li>
        </ul>
        <p>*NOTE: As of March 31 2021, Automox leverages the Foreground channel to download updates. There is work to change the channel used for downloading updates to the background channel. Suggestion is to throttle the background channel traffic only and not throttle the foreground channel once Automox switches its channel use.</p>
        <p><a href="https://learn.microsoft.com/en-us/windows/deployment/do/waas-delivery-optimization-reference#maximum-background-download-bandwidth-in-kbs" rel="nofollow">https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-reference#maximum-foreground-download-bandwidth-in-kbps</a>&#160;</p>
        <h4><strong>Considerations per environment</strong>
        </h4>
        <ul>
            <li>Download Mode - There are several options for different environments. &#160;Common options are:<ul><li>1 for LAN. Optionally add the “Select a method to restrict peer selection = 1” settings to further restrict sharing to other devices on the same subnet mask. This can be useful in large WAN environments with a centralized internet egress point to ensure devices share within their subnets only.</li><li>2 - Group. There are extensive options when utilizing Active Directory Sites, DHCP, DNS suffix, or Azure groups are utilized. You can also define a custom GUID to define your group. Please see the options available in the Microsoft documentation here: <a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-reference#select-the-source-of-group-ids" rel="nofollow">https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-reference#select-the-source-of-group-ids</a> </li><li>3 - Internet. This is ideal for devices that are always remote.</li></ul></li>
            <li>GroupID - Only relevant with specific download modes</li>
            <li>Select the source of Group IDs - &#160; The options set in this policy only apply to Group (2) download mode. If Group (2) isn't set as Download mode, this policy will be ignored.</li>
            <li>Select a method to restrict Peer Selection - option to filter peer selection by subnet mask when selecting LAN or Group Download Mode</li>
            <li>Delay background download from http (in secs) - discuss your installation expectations. The scenario above forces clients to leverage peer sharing by delaying fall back to downloading content directly from the internet for 10 minutes.</li>
            <li>Maximum Foreground and Background Download Bandwidth - discuss with the networking team to optimize settings. &#160;This could be specific to a specific office as an example should there be a high client count and\or low available bandwidth.</li>
            <li>Minimum Peer Caching Content File Size (in MB). &#160;We suggest lowering the minimum file size to share to encourage a higher peer-to-peer sharing percentage.</li>
            <li>Minimum RAM (inclusive) allowed to use Peer Caching (in GB). &#160;We recommend setting the minimum RAM requirement from the default of 4GB in environments where virtual devices or automated RAM allotment solutions are in place. &#160;If a device has less than the defined minimum RAM amount, DO will not honor the assigned configurations.</li>
        </ul>
        <h4>Automox and Delivery Optimization</h4>
        <p>To propagate peer-to-peer content sharing, consider staging updates prior to scheduled production patch policy time. This would match up well with a pilot patch policy run a day or so before production patch policies are scheduled (or within an appropriate amount of time to ensure the patches distributed earlier would match those needed at the production policy run time).</p>
        <p>Peer-to-peer content sharing via DO becomes more effective when there are 10 or more peers within a group. &#160;DO content sharing breaks up content into small portions, allowing peer connections to 10s - 100s of other devices at a time. &#160;Updates are not shared as a full patch, rather as smaller bits of content. &#160;This concept is important when considering a staging strategy.</p>
        <h4><strong>GPO and Registry Information</strong>
        </h4>
        <h5>Download Mode - DODownloadMode</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the download method that Delivery Optimization can use in downloads of Windows Updates, Apps and App updates.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DODownloadMode<br />Value Type: REG_DWORD<br />Value: The following list shows the supported values:</p>
                        <ul>
                            <li>0 = HTTP only, no peering.</li>
                            <li>1 = HTTP blended with peering behind the same NAT.</li>
                            <li>2 = HTTP blended with peering across a private group. Peering occurs on devices in the same Active Directory Site (if exist) or the same domain by default. When this option is selected, peering will cross NATs. To create a custom group use Group ID in combination with Mode 2.</li>
                            <li>3 = HTTP blended with Internet Peering.</li>
                            <li>99 = Simple download mode with no peering. Delivery Optimization downloads using HTTP only and does not attempt to contact the Delivery Optimization cloud services.</li>
                            <li>100 = Bypass mode. Do not use Delivery Optimization and use BITS instead.</li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Group ID - DOGroupId</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Group ID must be set as a GUID. This policy specifies an arbitrary group ID that the device belongs to.</p>
                        <p>Use this if you need to create a single group for Local Network Peering for branches that are on different domains or are not on the same LAN.<br /><strong>Note</strong>: this is a best effort optimization and should not be relied on for an authentication of identity.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOGroupId<br />Value Type: REG_SZ</p>
                        <p><strong>Note</strong>: You can generate a GUID easily with PowerShell: [guid]::NewGuid()</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Select the source of Group IDs - DOGroupIdSource</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Set this policy to restrict peer selection to a specific source.When set, the Group ID will be assigned automatically from the selected source. If you set this policy, the GroupID policy will be ignored.</p>
                        <p>The options set in this policy only apply to Group (2) download mode. If Group (2) isn't set as Download mode, this policy will be ignored.</p>
                        <p>For option 3 - DHCP Option ID, the client will query DHCP Option ID 234 and use the returned GUID value as the Group ID.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOGroupIdSourceValue Type: REG_DWORD<br />Value: Options available are:</p>
                        <ul>
                            <li>1 = AD Site.</li>
                            <li>2 = Authenticated domain SID.</li>
                            <li>3 = DHCP Option ID.</li>
                            <li>4 = DNS Suffix.</li>
                            <li>5 = AAD Tenant ID.</li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Select a method to restrict Peer Selection - DORestrictPeerSelectionBy</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Set this policy to restrict peer selection via selected option.</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DORestrictPeerSelectionByValue Type: REG_DWORD<br />Value: Options available are:</p>
                        <ul>
                            <li>1 = Subnet mask (more options will be added in a future release).</li>
                        </ul>
                        <p>Option 1 (Subnet mask) applies to both Download Mode LAN (1) and Group (2).</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Absolute Max Cache Size (in GB) - DOAbsoluteMaxCacheSize</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the maximum size in GB of Delivery Optimization cache.This policy overrides the DOMaxCacheSize policy.</p>
                        <p>The value 0 (zero) means "unlimited" cache; Delivery Optimization will clear the cache when the device runs low on disk space.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE|<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOAbsoluteMaxCacheSize<br />Value Type: REG_DWORD<br />Default Value: 10<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 10 G</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Delay background download from http (in secs) - DODelayBackgroundDownloadFromHttp</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>This policy allows you to delay the use of an HTTP source in a background download that is allowed to use P2P.</p>
                        <p>After the max delay has reached, the download will resume using HTTP, either downloading the entire payload or complementing the bytes that could not be downloaded from Peers.</p>
                        <p>Note that a download that is waiting for peer sources, will appear to be stuck for the end user.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DODelayBackgroundDownloadFromHttp<br />Value Type: REG_DWORD<br />Default Value: 0<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 0 (no delay)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Delay Foreground download from http (in secs) - DODelayForegroundDownloadFromHttp</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>This policy allows you to delay the use of an HTTP source in a foreground (interactive) download that is allowed to use P2P.</p>
                        <p>After the max delay has reached, the download will resume using HTTP, either downloading the entire payload or complementing the bytes that could not be downloaded from Peers.</p>
                        <p>Note that a download that is waiting for peer sources, will appear to be stuck for the end user.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DODelayForegroundDownloadFromHttp<br />Value Type: REG_DWORD<br />Default Value: 0<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 0 (no delay)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Maximum Download Bandwidth (in KB/s) - DOMaxDownloadBandwidth</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the maximum download bandwidth in KiloBytes/second that the device can use across all concurrent download activities using Delivery Optimization.</p>
                        <p>The default value 0 (zero) means that Delivery Optimization dynamically adjusts to use the available bandwidth for downloads.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOMaxDownloadBandwidth<br />Value Type: REG_DWORD<br />Default Value: 0<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 0 (unlimited)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Maximum Background Download Bandwidth (in KB/s) - DOMaxBackgroundDownloadBandwidth</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the maximum background download bandwidth in KiloBytes/second that the device can use across all concurrent download activities using Delivery Optimization.</p>
                        <p>The default value 0 (zero) means that Delivery Optimization dynamically adjusts to use the available bandwidth for downloads.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOMaxBackgroundDownloadBandwidth<br />Value Type: REG_DWORD<br />Default Value: 0<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 0 (unlimited)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Maximum Foreground Download Bandwidth (in KB/s) - DOMaxForegroundDownloadBandwidth</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the maximum foreground download bandwidth in KiloBytes/second that the device can use across all concurrent download activities using Delivery Optimization.</p>
                        <p>The default value 0 (zero) means that Delivery Optimization dynamically adjusts to use the available bandwidth for downloads.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOMaxForegroundDownloadBandwidth<br />Value Type: REG_DWORD<br />Default Value: 0<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 0 (unlimited)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Max Cache Age (in seconds) - DOMaxCacheAge</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the maximum time in seconds that each file is held in the Delivery Optimization cache after downloading successfully.</p>
                        <p>The value 0 (zero) means "unlimited"; Delivery Optimization will hold the files in the cache longer and make the files available for uploads to other devices, as long as the cache size has not exceeded.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name:DOMaxCacheAge<br />Value Type: REG_DWORD<br />Default Value: 259200<br />Min Value: 0<br />Max Value: 4294967295<br />The default value is 3 days</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Allow uploads while the device is on battery while under set Battery level (percentage) - DOMinBatteryPercentageAllowedToUpload</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specify any value between 1 and 100 (in percentage) to allow the device to upload data to LAN and Group peers while on DC power (Battery).</p>
                        <p>The recommended value to set if you allow uploads on battery is 40 (for 40%). The device can download from peers while on battery regardless of this policy.</p>
                        <p>The value 0 means "not-limited"; The cloud service set default value will be used.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOMinBatteryPercentageAllowedToUpload<br />Value Type: REG_DWORD<br />Default Value: 0<br />Min Value: 0<br />Max Value: 100<br />The default value is 0 (unlimited)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h5>Minimum RAM capacity (inclusive) required to enable use of Peer Caching (in GB) - DOMinRAMAllowedToPeer</h5>
        <table class="TableStyle-ax_tables" cellspacing="0" style="mc-table-style: url('../../Resources/TableStyles/ax_tables.css');">
            <colgroup>
                <col style="width: 760.0px;" />
            </colgroup>
            <tbody>
                <tr class="TableStyle-ax_tables-Body-Body1">
                    <td class="TableStyle-ax_tables-BodyA-Column1-Body1">
                        <p>Specifies the minimum RAM size in GB required to use Peer Caching.</p>
                        <p>For example if the minimum set is 1 GB, then devices with 1 GB or higher available RAM will be allowed to use Peer caching.</p>
                        <p>Recommended values: 1 GB to 4 GB.</p>
                        <p>Supported on: At least Windows 10 Server, Windows 10 or Windows 10 RT</p>
                        <p>Registry Hive: HKEY_LOCAL_MACHINE<br />Registry Path: SOFTWARE\Policies\Microsoft\Windows\DeliveryOptimization<br />Value Name: DOMinRAMAllowedToPeer<br />Value Type: REG_DWORD<br />Default Value: 4<br />Min Value: 1<br />Max Value: 100000<br />The default value is 4GB</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2>Index&#160;</h2>
        <h3>Sources</h3>
        <ol start="1">
            <li><a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization" rel="nofollow">Delivery Optimization for Windows 10 updates - Windows Deployment</a>
            </li>
            <li><a href="https://docs.microsoft.com/en-us/windows/deployment/do/waas-optimize-windows-10-updates" rel="nofollow">Optimize update delivery for Windows 10 updates (Windows 10) - Windows Deployment</a>
            </li>
            <li><a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-setup" rel="nofollow">Set up Delivery Optimization - Windows Deployment</a>
            </li>
            <li><a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization-reference" rel="nofollow">Delivery Optimization reference - Windows Deployment</a>
            </li>
            <li><a href="https://www.paloaltonetworks.com/cyberpedia/what-is-quality-of-service-qos" rel="nofollow">What is Quality of Service?</a>
            </li>
            <li><a href="https://docs.microsoft.com/en-us/windows-server/networking/technologies/qos/qos-policy-top" rel="nofollow">Quality of Service (QoS) Policy</a>
            </li>
            <li><a href="https://support.apple.com/guide/mac-help/what-is-content-caching-on-mac-mchl9388ba1b/mac" rel="nofollow">What is content caching on Mac?</a>
            </li>
            <li><a href="https://access.redhat.com/solutions/23016" rel="nofollow">How to create a local mirror of the latest update for Red Hat Enterprise Linux 5, 6, 7, 8 without using Satellite server?</a>
            </li>
            <li><a href="https://www.redhat.com/sysadmin/apache-yum-dnf-repo" rel="nofollow">Create an Apache-based YUM/DNF repository on Red Hat Enterprise Linux 8</a>
            </li>
            <li><a href="https://help.ubuntu.com/community/Repositories/Personal" rel="nofollow">Repositories/Personal - Community Help Wiki</a>
            </li>
            <li><a href="https://www.deploymentresearch.com/setup-delivery-optimization-do-for-configmgr-current-branch/" rel="nofollow">Setup Delivery Optimization (DO) for ConfigMgr Current Branch - Deployment Research</a>
            </li>
        </ol>
        <h3><a name="Referenc"></a>References</h3>
        <ul>
            <li>"What is Quality of Service? - Palo Alto Networks." <a href="https://www.paloaltonetworks.com/cyberpedia/what-is-quality-of-service-qos" rel="nofollow">https://www.paloaltonetworks.com/cyberpedia/what-is-quality-of-service-qos</a> . Accessed 8 Mar. 2021.</li>
            <li>“Delivery Optimization for Windows 10 updates”,<br /><a href="https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization" rel="nofollow">https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization</a> </li>
        </ul>
    </body>
</html>